{% extends 'books/base.html' %}
{% block style %}
    <style>
        .body {
            background-color: #989c8e;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        .registration-container {
            background: #fff;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            max-width: 400px;
            width: 100%;
        }

        .social-btn .btn {
            width: 100%;
            margin-bottom: 10px;
        }
    </style>
{% endblock %}
{% block content %}
<div class="body" style="
            background-color: #989c8e;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
">
    <!-- Registration Container -->
    <div class="registration-container" >
        <h2 class="text-center mb-4">Register</h2>
        <!-- Registration Form -->
        <form class="row g-3" method='post'>
             {% csrf_token %}
            <div class="col-6">
                <label for="inputEmail4" class="form-label">First Name</label>
                <input type="text" class="form-control" id="firstName">
            </div>
            <div class="col-6">
                <label for="inputPassword4" class="form-label">Last Name</label>
                <input type="text" class="form-control" id="lastName">
            </div>
            <div class="col-12">
                <label for="inputAddress" class="form-label">Email</label>
                <input type="email" class="form-control" id="email" placeholder="">
            </div>
            <div class="col-6">
                <label for="inputAddress2" class="form-label">Password</label>
                <input type="password" class="form-control" id="password1" placeholder="">
            </div>
            <div class="col-6">
                <label for="inputCity" class="form-label">Confirm Password</label>
                <input type="password" class="form-control" id="password2">
            </div>
            <div class="col- 12">
                <button type="submit" class="btn btn-primary col-12">Sign up</button>
            </div>
        </form>
        <!-- Social Login Section -->
        <div class="social-login mt-4">
            <p class="text-center mb-3">Or register with:</p>
            <div class="social-btn">
                <button class="btn btn-danger w-100" onclick="loginWithGoogle()">
                    <i class="fab fa-google"></i> Google
                </button>
                <button class="btn btn-primary w-100 mt-2" onclick="loginWithFacebook()">
                    <i class="fab fa-facebook"></i> Facebook
                </button>
            </div>
        </div>
        <!-- Link to Login Page -->
        <p class="text-center mt-4">
            Already have an account? <a href="login.html">Login here</a>
        </p>
    </div>
</div>

    <!-- Bootstrap JS and dependencies -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Custom JS -->
    <script>
        // Handle registration form submission
       document.addEventListener("DOMContentLoaded", function () {
    document.querySelector("form").addEventListener("submit", async function (e) {
        e.preventDefault();

        // Get form values
        const firstName = document.getElementById('firstName').value.trim();
        const lastName = document.getElementById('lastName').value.trim();
        const email = document.getElementById('email').value.trim();
        const password1 = document.getElementById('password1').value;
        const password2 = document.getElementById('password2').value;

        // Basic validation
        if (!firstName || !lastName || !email || !password1 || !password2) {
            alert('Please fill in all fields');
            return;
        }

        if (password1 !== password2) {
            alert('Passwords do not match!');
            return;
        }

        const registrationUrl = '/api/auth/register/';  // Remove the full URL, use relative path

        try {
            const response = await fetch(registrationUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value // Add CSRF token
                },
                credentials: 'include', // Important for cookies
                body: JSON.stringify({
                    first_name: firstName,
                    last_name: lastName,
                    email: email,
                    password: password1
                })
            });

            const data = await response.json();

            if (response.ok) {
                alert('Registration successful! Redirecting to login...');
                window.location.href = '/user_login/'; // Update to match your login URL
            } else {
                // More detailed error handling
                let errorMessage = 'Registration failed: ';
                if (data.detail) {
                    errorMessage += data.detail;
                } else if (data.email) {
                    errorMessage += `Email: ${data.email.join(', ')}`;
                } else if (data.password) {
                    errorMessage += `Password: ${data.password.join(', ')}`;
                } else {
                    errorMessage += 'Please check your information and try again.';
                }
                alert(errorMessage);
            }
        } catch (error) {
            console.error('Registration error:', error);
            alert('An error occurred. Please try again.');
        }
    });
});
        // Placeholder functions for social login
        function loginWithGoogle() {
            alert('Redirecting to Google login...');
            // Replace with actual Google OAuth implementation
        }

        function loginWithFacebook() {
            alert('Redirecting to Facebook login...');
            // Replace with actual Facebook OAuth implementation
        }
    </script>
{% endblock %}