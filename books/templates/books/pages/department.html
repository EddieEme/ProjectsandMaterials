{% load static %}
{% load custom_filters %}
{% block link %}
<link href="{% static 'books/department.css' %}" rel="stylesheet">
<link href="{% static 'books/css/project.css' %}" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.11.1/font/bootstrap-icons.min.css" rel="stylesheet">
{% endblock %}

{% block style %}
<style>
:root {
    --primary-color: #4f46e5;
    --secondary-color: #f8fafc;
    --accent-color: #06b6d4;
    --text-dark: #1e293b;
    --text-light: #64748b;
    --border-color: #e2e8f0;
    --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
    --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
    --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
    --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    --gradient-accent: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
    min-height: 100vh;
    color: var(--text-dark);
}

a {
    text-decoration: none;
}

/* Header Card Styling */
.search-section {
    background: var(--gradient-primary);
    border: none;
    border-radius: 20px;
    box-shadow: var(--shadow-lg);
    margin-bottom: 2rem;
    overflow: hidden;
    position: relative;
}

.search-section::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="50" cy="50" r="1" fill="white" opacity="0.1"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
    opacity: 0.1;
}

.search-content {
    position: relative;
    z-index: 1;
    text-align: center;
    padding: 3rem 2rem;
    margin-top: 4rem;
}

.search-content h2 {
    font-size: 2.5rem;
    font-weight: 700;
    color: white;
    margin-bottom: 1.5rem;
    text-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

/* Search Box Styling */
.input-group {
    max-width: 600px;
    margin: 0 auto;
}

.form-control {
    border: none;
    border-radius: 50px 0 0 50px !important;
    padding: 1rem 1.5rem;
    font-size: 1.1rem;
    box-shadow: var(--shadow-sm);
    background: white;
    transition: all 0.3s ease;
}

.form-control:focus {
    box-shadow: var(--shadow-md);
    outline: none;
    border: 2px solid var(--primary-color);
}

.btn-primary {
    border-radius: 0 50px 50px 0 !important;
    background: var(--gradient-accent);
    border: none;
    padding: 1rem 1.5rem;
    font-weight: 500;
}

/* Books Grid Layout - Exactly 3 cards per row on desktop */
.books-list {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1.5rem;
    padding: 1rem 0;
}

.book-item {
    transition: transform 0.3s ease;
}

.book-card {
    border: none;
    border-radius: 20px;
    box-shadow: var(--shadow-md);
    background: white;
    transition: all 0.3s ease;
    overflow: hidden;
    height: 100%;
    position: relative;
}

.book-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: var(--gradient-accent);
}

.book-card:hover {
    transform: translateY(-8px);
    box-shadow: var(--shadow-lg);
}

.book-card .card-body {
    padding: 1.5rem;
}

.book-card .card-body  img{
    width:100%;
    height:200px;
    object-fit: cover;
}

.book-card .card-title {
    color: var(--text-dark);
    font-weight: 600;
    font-size: 1.2rem;
    line-height: 1.4;
    margin-bottom: 1rem;
}

.book-card .card-text {
    color: var(--text-light);
    line-height: 1.5;
    margin-bottom: 1.5rem;
    font-size: 0.95rem;
}

.stats {
    font-size: 0.85rem;
    color: var(--text-light);
}

.slag {
    display: flex;
    justify-content: space-between;
    align-items: center;
    width: 100%;
    flex-wrap: wrap;
    gap: 0.5rem;
}

.category-badge {
    background: var(--gradient-primary) !important;
    border: none;
    padding: 0.4rem 0.8rem;
    border-radius: 20px;
    font-weight: 500;
    font-size: 0.8rem;
    color: white;
}

/* No Results Message */
#no-results-message {
    display: none;
    grid-column: 1 / -1;
    text-align: center;
    padding: 2rem;
    background: white;
    border-radius: 20px;
    box-shadow: var(--shadow-sm);
}

/* Pagination Styling */
.pagination {
    justify-content: center;
    margin: 2rem 0;
}

.page-link {
    border: none;
    color: var(--primary-color);
    background: white;
    margin: 0 0.25rem;
    border-radius: 12px;
    padding: 0.5rem 1rem;
    font-weight: 500;
    box-shadow: var(--shadow-sm);
    transition: all 0.3s ease;
}

.page-link:hover {
    background: var(--primary-color);
    color: white;
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
}

.page-item.active .page-link {
    background: var(--primary-color);
    color: white;
    box-shadow: var(--shadow-md);
}

/* Responsive Design */
@media (max-width: 1200px) {
    .books-list {
        grid-template-columns: repeat(2, 1fr);
    }
}

@media (max-width: 768px) {
    .books-list {
        grid-template-columns: 1fr;
    }
    
    .search-content {
        padding: 2rem 1rem;
    }
    
    .search-content h2 {
        font-size: 1.8rem;
    }
    
    .form-control, .btn-primary {
        padding: 0.75rem 1.25rem;
    }
}

@media (max-width: 576px) {
    .search-content h2 {
        font-size: 1.5rem;
    }
    
    .slag {
        flex-direction: column;
        align-items: flex-start;
    }
}

/* Animation */
.book-item {
    animation: fadeInUp 0.6s ease forwards;
    opacity: 0;
    transform: translateY(30px);
}

@keyframes fadeInUp {
    to {
        opacity: 1;
        transform: translateY(0);
    }
}
</style>
{% endblock %}

{% block content %}
<!-- Search Section -->
<div class="search-section card-head">
    <div class="container search-content">
        <h2 class="text-center mb-4">{{ category }} Books</h2>
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="input-group">
                    <input type="text" id="searchInput" class="form-control" placeholder="Search books..." oninput="searchBooks()">
                    <button class="btn btn-primary" type="button" id="searchButton">
                        <i class="bi bi-search"></i> Search
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Books List -->
<div class="container">
    <div class="books-list" id="booksList">
        {% for book in books %}
        <div class="book-item" style="animation-delay: {{ forloop.counter|divisibleby:3|yesno:'0.1s,0.2s,0.3s' }}">
            <a href="/product-details/{{ book.slug }}/" class="text-decoration-none">
                <div class="card book-card">
                    <div class="card-body">
                    <img src="{% if book.cover_image %}{{ book.cover_image.url }}{% else %}{% static 'books/images/advert_cover.jpg' %}{% endif %}" >
                        <h5 class="card-title"><b>{{ book.title }}</b></h5>
                        <p class="card-text">{{ book.description|unescape_html|truncatehtml:70|safe }}</p>
                        <div class="stats">
                            <span class="slag">
                                <span class="badge bg-primary category-badge">{{ book.category.name }}</span>
                                <span>
                                    <i class="bi bi-eye"></i> {{ book.views|default:0 }} views
                                    <i class="bi bi-chat ms-2"></i> {{ book.comments|default:0 }} comments
                                </span>
                            </span>
                        </div>
                    </div>
                </div>
            </a>
        </div>
        {% empty %}
        <div class="col-12 text-center">
            <p>No books available.</p>
        </div>
        {% endfor %}
    </div>
    
    <!-- No Results Message -->
    <div id="no-results-message" class="mt-4">
        <h5>Topic not found</h5>
        <p>Sorry, we couldn't find any books matching your search.</p>
    </div>
    
    <!-- Pagination -->
    <nav aria-label="Books pagination" class="my-4">
        <ul class="pagination">
            {% if books.has_previous %}
                <li class="page-item"><a class="page-link" href="?page={{ books.previous_page_number }}">Previous</a></li>
            {% endif %}
            
            {% for num in books.paginator.page_range %}
                {% if books.number == num %}
                    <li class="page-item active"><a class="page-link" href="#">{{ num }}</a></li>
                {% else %}
                    <li class="page-item"><a class="page-link" href="?page={{ num }}">{{ num }}</a></li>
                {% endif %}
            {% endfor %}
            
            {% if books.has_next %}
                <li class="page-item"><a class="page-link" href="?page={{ books.next_page_number }}">Next</a></li>
            {% endif %}
        </ul>
    </nav>
</div>

<script>
function searchBooks() {
    const searchTerm = document.getElementById('searchInput').value.toLowerCase();
    const books = document.querySelectorAll('.book-item');
    const noResultsMessage = document.getElementById('no-results-message');
    let resultsFound = false;
    
    books.forEach(book => {
        const title = book.querySelector('.card-title').textContent.toLowerCase();
        const desc = book.querySelector('.card-text').textContent.toLowerCase();
        
        if (title.includes(searchTerm) || desc.includes(searchTerm)) {
            book.style.display = 'block';
            resultsFound = true;
        } else {
            book.style.display = 'none';
        }
    });
    
    // Show/hide no results message
    if (searchTerm.trim() !== '' && !resultsFound) {
        noResultsMessage.style.display = 'block';
    } else {
        noResultsMessage.style.display = 'none';
    }
}

document.addEventListener('DOMContentLoaded', function() {
    // Initialize search on page load
    searchBooks();
    
    // Add click event for search button
    document.getElementById('searchButton').addEventListener('click', searchBooks);
});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
{% endblock %}